<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Repertoire Chess Utility</title>
    <!-- suppress favicon search -->
    <link rel="icon" href="data:,"> 
    
    <style>
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        background-color: #333;
        padding: 1rem;
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      input, button {
        padding: 0.5rem;
        font-size: 1rem;
        border-radius: 5px;
      }

      button {
        cursor: pointer;
        background-color: #2f4443;
        color: #fff;
        border: none;
      }

      button:hover {
        background-color: #2f4443;
      }

      label {
        margin-bottom: 0.5rem;
      }

      #openings-container, #flagged-drills-container {
        display: none;
      }

      .container {
        margin: 1rem 0;
      }

      #manage-openings-container {
      display: none; /* Initially hidden */
      }
      
      .opening-button {
        margin: 3px;
      }

      #login-container {
        display: none;
      }
      /* Style for smaller screens (e.g., phones) */
      @media screen and (max-width: 768px) {
        .opening-button {
        width: 40%; 
        } 
      }

      /* #manage-openings-container button {
      /* Add your desired button styles here */
      /* } */

      /* Media queries for responsiveness */
      @media (min-width: 768px) {
        body {
          padding: 2rem;
        }
      }

      /* Basic CSS for the modal */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: white;
        margin: 15% auto;
        padding: 20px;
        width: 80%;
        max-width: 500px;
        text-align: center;
      }

      .hidden {
        display: none;
      }


    </style>
  </head>
 
  <body>
    <div id="login-container">
      <form id="login-form">
        <label for="email">Email:</label>
        <input type="email" id="email" required>
        <label for="password">Password:</label>
        <input type="password" id="password" required>
        <button type="submit" id="login-btn">Log In</button>
        <button type="button" id="signup-btn">Sign Up</button>
      </form>
    </div>
    <!-- <button type="button" id="get-user-data-btn">Get User Data</button> -->

    <!-- Containers for a button for each opening in the user's database. -->
    <!-- Flagged Drills interface... etc. -->

    <div id="flagged-drills-container" class="container"></div>
    <div id="openings-for-white-container" class="container"></div>
    <div id="openings-for-black-container" class="container"></div>
    <div id="flagged-drills-interact-container" class="container">
      <button type="button" id="flag-last-drill-button">Flag Last Drill</button>
      <button id="remove-last-flagged-drill-btn" class="hidden">Remove Last Flagged Drill</button>


    </div>
    <div id="manage-openings-container" class="container">
      <button type="button" id="import-new-opening-btn">Import New Opening</button>
      <button type="button" id="remove-opening-btn">Remove Opening</button>
    </div>

    <button type="button" id="logout-btn">Log Out</button>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-analytics.js";
      import { getAuth } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-auth.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries


      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyD1cxRuxfABPCNdA072NqkBx_Se7cdy19Q",
        authDomain: "project-repertoire.firebaseapp.com",
        projectId: "project-repertoire",
        storageBucket: "project-repertoire.appspot.com",
        messagingSenderId: "1077824903060",
        appId: "1:1077824903060:web:394b50f971a3edd575a181",
        measurementId: "G-7B2Z15KFWL"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth(app);
      
      import { getCurrentUserId, fetchUserData, buildUsersOpeningsUI, removeAllButtons } from "./js/userDataInteractions.js";
      // Add event listener for authentication state changes
        auth.onAuthStateChanged((user) => {
        const loginContainer = document.getElementById("login-container");
        const logoutButton = document.getElementById("logout-btn");
        const manageOpeningsContainer = document.getElementById("manage-openings-container");

        if (user) { // User is signed in
          console.log("User is signed in:", user);

          // Hide the login form
          loginContainer.style.display = "none";
          // loginForm.style.display = "none";
          // Show the logout button
          logoutButton.style.display = "block";
          // Get the user data and make the buttons. 
          buildUsersOpeningsUI(user.uid);
          // Show the import and remove buttons
          manageOpeningsContainer.style.display = "block";


        } else { // User is signed out or there is no user signed in
          console.log("No user is signed in.");
          // Hide the manage openings container
          manageOpeningsContainer.style.display = "none";
          // Remove all buttons
          removeAllButtons();

          // Hide the logout button
          logoutButton.style.display = "none";
          // Show the login form
          loginContainer.style.display = "block";
          // loginForm.style.display = "block";
          // Clear the login form
          loginForm.reset();
        }
        });
      window.app = app;
    </script>

    <script type="module" src="https://www.gstatic.com/firebasejs/9.20.0/firebase-auth.js"></script>
    <script type="module" src="js/authentication.js"></script>
    <script type="module" src="js/manageOpenings.js"></script>
    <script type="module" src="js/uiFeedback.js"></script>

    <!-- Force reload of the page when user returns using the back button. -->
    <script>
      window.addEventListener('pageshow', (event) => {
        if (event.persisted) {
          window.location.reload();
        }
      });
    </script>
    
    
    <!-- Modal structure for removing an opening -->
    <div id="remove-opening-modal" class="modal">
      <div class="modal-content">
        <h3>Select an opening to remove</h3>
        <select id="remove-opening-select"></select>
        <button id="remove-opening-confirm-btn">Remove</button>
        <button id="remove-opening-cancel-btn">Cancel</button>
      </div>
    </div>


  </body>
</html>
